# Team WorkFromHome Web Server

## 1. Structure of Project

Our web server is written in C++, and the following diagram describes the interaction between header files within the project. A short summary of each header file follows.

```
                                                              |----------------------------|
                                                              |      Parse the Config      |
                                                              |   nginx_config_parser.h    |
                                    server_main.cc ---------->|  nginx_config_statement.h  |
                                          |                   |       nginx_config.h       |
logging throughout                        |                   |----------------------------|
the entire application                    |
                                          |                   |----------------------------|
                                          |                   |    Register all handlers   |
                                       server.h ------------->|        dispatcher.h        |
                                          |                   |      request_handler.h     |
                                          |                   |----------------------------|
                        one session per   |                                      |
                        request received  |                                      | user dispatcher to fetch
                                          |                                      |         handler
                                       session.h ---------------> |--------------------------------|
                                          |                       |   User handler to create reply |
                                          |                       |            reply.h             |
                                          |                  |--> |         echo_handler.h         |
                                          |                  |    |        static_handler.h        |
                                          |                  |    |      bad_request_handler.h     |
                              |-------------------------|    |    |        status_handler.h        |
                              | Create a request object |    |    |--------------------------------|
                              |    request_parser.h     |----|
                              |       request.h         |
                              |-------------------------|
                                       
```

## Config_Parser

### nginx_config_parser.h 
Parses a config file and registers all handler blocks and port number to launch the server on

### nginx_config_statement.h
A helper class for the config and config parser which keeps tracks of tokens of the config file

### nginx_config.h
A final, parsed config file represented as a class that our server then utilizes the listen on ports and launch handlers

## HTTP

### reply.h
A reply object used by the server to send responses back to clients. Generated by request handlers. Follows the Common API

### request.h
A request object used by the server that contains the parsed request sent by client. This request is used to generate a reply from a request handler.

### request_parser.h
A request parser that ensures requests sent are in HTTP format. 

## Request_Handler

### dispatcher.h
A dispatcher that given a url, will properly identify which handler is registered to the endpoint and return it back to the session. Also registers handlers based on the parsed configuration file.

### request_handler.h
A base class for all request handlers. Defines the methods that all request handlers need to implement (such as HandleRequest)

### echo_request_handler.h
Serves echo requests -> sends back the request in the response

### static_request_handler.h
Serves static requests -> looks for the requested file on the server and sends it back if possible

### bad_request_handler.h
The request handler returned when no handler can be found. It is currently configured to "/"

### status_handler.h
Serves the "/status" endpoint which returns health information about our server including number of requests received, status of requests received, and other important information.

## server.h
The server code that launches the dispatcher to start creating handlers and also manages the creation of sessions for each request

## session.h
Responsible for receiving requests, launching the request parser to create request objects, calling the dispatcher to use the handlers to generate proper reply objects from the request, and finally writing the reply back to the client.

## logger/logger.h
Manages the logging object that writes server events for all files. 


## 2. Building the Project

### Building Locally on Docker

1. Build and tag a base image
docker build -f docker/base.Dockerfile -t wfh-web-server:base .

2. Build an image for our webserver
``` docker build -f docker/Dockerfile -t wfh_web_server_image . ```

To build the container for test coverage
``` docker build -f docker/coverage.Dockerfile -t wfh_web_server_tcoverage . ```

3. Run the image for our webserver, mapping the local port 8080 to the container's port 80
``` docker run --rm -p 8080:80 --name my_run wfh_web_server_image:latest ```

4. To stop the currently running Docker image, use the following command in another terminal window
``` docker container stop my_run ```